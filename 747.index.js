"use strict";(self.webpackChunkself_create=self.webpackChunkself_create||[]).push([[747],{7747:(e,t,n)=>{n.d(t,{A:()=>w});var r=n(758),i=n(8674),a=n(3063),o=n(8885),s=n(2367),l=n(9755),u=n(2390),c=n.n(u),d=n(4062),h=n(9464),f=n(8073);function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Image;return n.crossOrigin="anonymous",n.src=e,new Promise((function(e){n.onload=function(){var r=document.createElement("canvas");r.width=n.width,r.height=n.height;var i=r.getContext("2d");if(!i)throw new Error("无法获取 canvas 的 2D 绘图上下文");i.drawImage(n,0,0);var a=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.data,r=e.width,i=e.height,a=[],o=0;o<i;o+=1)for(var s=0;s<r;s+=1){var l=4*(o*r+s);if(0!==n[l+3]){var u=n[l],c=n[l+1],d=n[l+2];t&&u>50||a.push({x:s-r/2,y:i/2-o,color:"rgb(".concat(u,",").concat(c,",").concat(d,")")})}}return a}(i.getImageData(0,0,n.width,n.height),t);e(a)}}))}function v(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t.filter((function(e,t){return t%4==0})),i=new Float32Array(3*r.length),a=function(e){for(var t=new Float32Array(3*e),n=0;n<e;n+=1){var r=30*Math.random()+1,i=Math.random()*Math.PI*2,a=Math.cos(i)*r+10*(Math.random()-.5),o=Math.sin(i)*r+10*(Math.random()-.5),s=2*(Math.random()-.5);t[3*n]=a,t[3*n+1]=o,t[3*n+2]=s}return t}(r.length),o=new Float32Array(3*r.length),s=new Float32Array(r.length),l=0;l<r.length;l+=1){var u=r[l],c=u.x,d=u.y;i[3*l]=c*n,i[3*l+1]=d*n,i[3*l+2]=3*(Math.random()-.5),o[3*l]=.1*(Math.random()-.5),o[3*l+1]=.2*Math.random(),o[3*l+2]=.1*(Math.random()-.5),s[l]=4*Math.random()}return e.setAttribute("position",new h.THS(i,3)),e.setAttribute("initialPosition",new h.THS(a,3)),e.setAttribute("velocity",new h.THS(o,3)),e.setAttribute("lifetime",new h.THS(s,1)),e}var p=d.K,g=function(){return(0,l.A)((function e(t){(0,s.A)(this,e),this.renderer=t,this.renderer.scene.background=new h.Q1f("#e7fcf6"),this.gui=new f.Ay,this.tweenGroup=new d.YJ,this.guiParams={pointSize:6,speed:.1,lifeCycle:20,updateProbability:0,color:11393254},this.time=0,this.progress=0,this.addGUI(),function(e){document.addEventListener("dblclick",(function(){document.fullscreenElement?document.exitFullscreen():e.domElement.requestFullscreen()}))}(t),this.imgPixels={},this.createPoint3d()}),[{key:"dispose",value:function(){this.renderer.cleanup(this.point3d),this.renderer.cancelAnimate(),this.gui.destroy(),this.gui=new f.Ay,this.addGUI()}},{key:"createPoint3d",value:function(){var e=new h.LoY;this.point3d=new h.ONl(e);var t=this.createGradualMaterial();this.point3d.material=t,this.point3d.material.needsUpdate=!0,this.material=t,this.renderer.add(this.point3d),this.renderer.animate(this.update.bind(this))}},{key:"loadImgs",value:(t=(0,o.A)(c().mark((function e(t){var n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=(0,o.A)(c().mark((function e(t){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(t);case 2:r=e.sent,n.imgPixels[t]=r;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"updateGeometry",value:function(e){var t=this,n=this.imgPixels[e];if(n){v(this.point3d.geometry,n,.1),this.renderer.render();var r=new p(this.material.uniforms.uProgress).to({value:1},2e3).delay(500).onComplete((function(){t.material&&(t.material.uniformsNeedUpdate=!0)})).start();this.tweenGroup.add(r)}}},{key:"createPoints",value:(e=(0,o.A)(c().mark((function e(){var t,n,r,i,a=this,o=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:"/fish.svg",this.time=0,e.next=4,this.recovery();case 4:return e.next=6,m(t);case 6:n=e.sent,v(this.point3d.geometry,n,.1),r=this.createGradualMaterial(),this.point3d.material=r,this.point3d.material.needsUpdate=!0,this.material=r,this.renderer.render(),i=new p(this.material.uniforms.uProgress).to({value:1},2e3).delay(100).onComplete((function(){a.material.uniformsNeedUpdate=!0})).start(),this.tweenGroup.add(i);case 15:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"recovery",value:function(){var e=this;return new Promise((function(t,n){if(e.material){var r=new p(e.material.uniforms.uProgress).to({value:0},300).onComplete((function(){e.material&&(e.material.uniformsNeedUpdate=!0),t()})).start();e.tweenGroup.add(r)}else n()}))}},{key:"addGUI",value:function(){var e=this;this.gui.add(this.guiParams,"pointSize",.1,12).onChange((function(t){e.guiParams.pointSize=t,e.material&&(e.material.uniforms.pointSize.value=t,e.material.needsUpdate=!0,e.renderer.render())})),this.gui.addColor(this.guiParams,"color").onChange((function(t){e.guiParams.color=t,e.material&&(e.material.uniforms.uColor.value=new h.Q1f(t),e.renderer.render())}))}},{key:"createFallMaterial",value:function(){return new h.BKk({uniforms:{time:{value:0},pointSize:{value:this.guiParams.pointSize},lifeCycle:{value:this.guiParams.lifeCycle},updateProbability:{value:this.guiParams.updateProbability},uProgress:{value:0}},vertexShader:"attribute vec3 color;\r\nattribute float lifetime;\r\nattribute vec3 velocity;\r\nattribute vec3 initialPosition;\r\nuniform float pointSize;\r\nuniform float lifeCycle;\r\nuniform float time;\r\nuniform float updateProbability;\r\nvarying vec3 fragColor;\r\nvarying float vAlpha;\r\n\r\nvoid main() {\r\n    fragColor = color;\r\n    float life = mod(lifetime + time, lifeCycle);\r\n    vAlpha = 1.0;\r\n    vec3 pos = position;\r\n    float ps = pointSize;\r\n     if (lifetime > updateProbability) {\r\n        pos -= velocity * life; \r\n        vAlpha = 1.0 - life / lifeCycle;\r\n        ps = vAlpha * pointSize;\r\n    }\r\n\r\n    gl_PointSize = ps;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );\r\n}",fragmentShader:"varying vec3 fragColor;\r\nvarying float vAlpha;\r\n\r\nvoid main() {\r\n    gl_FragColor = vec4(fragColor, vAlpha );\r\n}",transparent:!0,depthWrite:!1})}},{key:"createGradualMaterial",value:function(){return new h.BKk({uniforms:{time:{value:0},pointSize:{value:this.guiParams.pointSize},uColor:{value:new h.Q1f(this.guiParams.color)},uProgress:{value:0}},vertexShader:"attribute vec3 initialPosition;\r\nattribute vec3 velocity;\r\nattribute float lifetime;\r\nuniform float pointSize;\r\nuniform float uProgress;\r\nvarying float vDepth;\r\n\r\nvoid main() {\r\n    vDepth = position.z;\r\n    vec3 pos = mix(initialPosition, position, uProgress);\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0 );\r\n    gl_PointSize = pointSize;\r\n}",fragmentShader:"uniform vec3 uColor;\r\nvarying float vDepth;\r\n\r\nvec3 getColor(float depth, vec3 color) {\r\n    float value = -depth * 60.0;\r\n    float r = clamp(color.r - value/255.0, 0.0, 1.0);\r\n    float g = clamp(color.g - value/255.0, 0.0, 1.0);\r\n    float b = clamp(color.b - value/255.0, 0.0, 1.0);\r\n    return vec3(r, g, b);\r\n}\r\n\r\nvoid main() {\r\n    float dist = distance(gl_PointCoord, vec2(0.5));\r\n    float mask = smoothstep(0.5,0.499,dist);\r\n    \r\n    gl_FragColor = vec4(getColor(vDepth, uColor), 1.0 * mask );\r\n}",transparent:!0,depthWrite:!1})}},{key:"update",value:function(){this.tweenGroup.update()}}]);var e,t}(),y=n(6070);const w=(0,a.U_)((function(e){var t=e.imgUrl,n=e.allPaths,o=(0,r.useContext)(a.P7),s=(0,i.A)((function(){return new g(o)}),[o]);return(0,r.useEffect)((function(){return function(){return s.dispose()}}),[]),(0,r.useEffect)((function(){n&&s.loadImgs(n)}),[n]),(0,r.useEffect)((function(){null!=n&&n.length&&t?s.updateGeometry(t):s.createPoints(t)}),[t,n]),(0,y.jsx)("div",{})}))},3063:(e,t,n)=>{n.d(t,{P7:()=>w,U_:()=>b});var r=n(3205),i=n(7294),a=n(758),o=n(2367),s=n(9755),l=n(9532),u=n(8008),c=n(5007),d=n(3171),h=n(9464),f=n(4218);function m(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(m=function(){return!!e})()}var v=function(e){function t(e){var n,i,a,s;(0,o.A)(this,t),i=this,a=t,a=(0,u.A)(a),n=(0,l.A)(i,m()?Reflect.construct(a,[],(0,u.A)(i).constructor):a.apply(i,s)),(0,r.A)(n,"animationId",-1),(0,r.A)(n,"destroyed",!1),(0,r.A)(n,"handleWindowResize",(function(){n.renderer.setSize(n.domElement.clientWidth,n.domElement.clientHeight);var e=n.domElement.clientWidth/n.domElement.clientHeight;n.updateFrustum(e)})),n.domElement=e;var c=e.clientWidth,f=e.clientHeight;return n.renderer=new d.JeP,n.scene=new h.Z58,n.scene.background=new h.Q1f(657930),n.renderer.setSize(c,f),n.initCamera("orthographic"),n.domElement.append(n.renderer.domElement),n.initCameraControls(),n.addLight(),n.resize(),n}return(0,c.A)(t,e),(0,s.A)(t,[{key:"dispose",value:function(){this.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize)}},{key:"initCameraControls",value:function(){var e=this,t=new f.N(this.camera,this.renderer.domElement);this.controls=t,t.addEventListener("change",(function(){e.render()}))}},{key:"initCamera",value:function(e){var t="perspective"===e,n=this.domElement.clientWidth/this.domElement.clientHeight;if(t)this.camera=new h.ubm(50,n,.1,2e3),this.camera.position.set(0,0,50);else{this.camera=new h.qUd(-500,500,500/n,-500/n,.1,2e3),this.camera.position.set(0,0,60)}}},{key:"addLight",value:function(){var e=new h.ZyN(16777215,1.5),t=new h.$p8(16777215,Math.PI);e.position.set(5,20,-5),t.position.set(0,20,0),this.add(t,e)}},{key:"setControlEnabled",value:function(e){this.controls.enabled=e}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"add",value:function(){var e;(e=this.scene).add.apply(e,arguments)}},{key:"cleanup",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.filter(Boolean);r.forEach((function(e){e.removeFromParent(),requestIdleCallback((function(){e.traverse((function(e){return function(e){null==e||e.dispatchEvent({type:"removed"}),e.geometry&&(e.geometry.dispose(),delete e.geometry)}(e)}))}))})),r.length&&this.render()}},{key:"resize",value:function(){window.addEventListener("resize",this.handleWindowResize)}},{key:"updateFrustum",value:function(e){if(this.camera instanceof h.qUd){var t=this.camera.right;this.camera.left=-t,this.camera.right=t,this.camera.top=t/e,this.camera.bottom=-t/e,this.camera.updateProjectionMatrix()}else this.camera instanceof h.ubm&&(this.camera.aspect=e,this.camera.updateProjectionMatrix())}},{key:"renderSync",value:function(){this.destroyed||(this.render(),this.dispatchEvent({type:"afterRender"}))}},{key:"animate",value:function(e){this.renderSync(),this.animationId=requestAnimationFrame(this.animate.bind(this,e)),e&&!this.destroyed&&e()}},{key:"cancelAnimate",value:function(){-1!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=-1),this.renderSync()}}])}(function(){return(0,s.A)((function e(){(0,o.A)(this,e),this.listeners=new Map,this.tracedTypeSet=new Set}),[{key:"addEventListener",value:function(e,t){var n=this.listeners.get(e);n||(n=[],this.listeners.set(e,n)),n.includes(t)||n.push(t)}},{key:"removeEventListener",value:function(e,t){var n=this.listeners.get(e);if(n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},{key:"hasEventListener",value:function(e,t){var n=this.listeners.get(e);return!!n&&n.includes(t)}},{key:"getEventListeners",value:function(e){return this.listeners.get(e)}},{key:"dispatchEvent",value:function(e){var t=this.listeners.get(e.type);if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r+=1)n[r].call(this,e);e.target=null}this.log(e)}},{key:"trace",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(t){return e.tracedTypeSet.add(t)}))}},{key:"log",value:function(e){if(this.tracedTypeSet.has(e.type)){var t=this.getEventListeners(e.type)||[];console.log("".concat(e.type," event executed ").concat(t.length," listeners")),console.log(t)}}}])}()),p=n(6070);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w=(0,a.createContext)(null);function P(e){var t=(0,a.useState)(null),n=(0,i.A)(t,2),r=n[0],o=n[1],s=(0,a.useCallback)((function(e){o((function(){return e?new v(e):(null==r||r.dispose(),null)}))}),[]);(0,a.useEffect)((function(){return function(){r&&r.dispose()}}));var l="inner"===e.mode?e.style||{}:{position:"absolute",top:0,right:0,bottom:0,left:0,userSelect:"none"};return(0,p.jsxs)(w.Provider,{value:r,children:[(0,p.jsx)("div",{ref:s,style:l}),r&&e.children]})}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){return(0,p.jsx)(P,y(y({},t),{},{children:(0,p.jsx)(e,y({},n))}))}}}}]);