"use strict";(self.webpackChunkself_create=self.webpackChunkself_create||[]).push([[537],{3063:(e,t,n)=>{n.d(t,{P7:()=>g,U_:()=>k});var a=n(3205),i=n(7294),s=n(758),r=n(2367),o=n(9755),c=n(9532),l=n(8008),h=n(5007),d=n(3171),u=n(9464),p=n(4218);function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(y=function(){return!!e})()}var f=function(e){function t(e){var n,i,s,o;(0,r.A)(this,t),i=this,s=t,s=(0,l.A)(s),n=(0,c.A)(i,y()?Reflect.construct(s,[],(0,l.A)(i).constructor):s.apply(i,o)),(0,a.A)(n,"animationId",-1),(0,a.A)(n,"destroyed",!1),(0,a.A)(n,"handleWindowResize",(function(){n.renderer.setSize(n.domElement.clientWidth,n.domElement.clientHeight);var e=n.domElement.clientWidth/n.domElement.clientHeight;n.updateFrustum(e)})),n.domElement=e;var h=e.clientWidth,p=e.clientHeight;return n.renderer=new d.JeP,n.scene=new u.Z58,n.scene.background=new u.Q1f(657930),n.renderer.setSize(h,p),n.initCamera("orthographic"),n.domElement.append(n.renderer.domElement),n.initCameraControls(),n.addLight(),n.resize(),n}return(0,h.A)(t,e),(0,o.A)(t,[{key:"dispose",value:function(){this.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize)}},{key:"initCameraControls",value:function(){var e=this,t=new p.N(this.camera,this.renderer.domElement);this.controls=t,t.addEventListener("change",(function(){e.render()}))}},{key:"initCamera",value:function(e){var t="perspective"===e,n=this.domElement.clientWidth/this.domElement.clientHeight;if(t)this.camera=new u.ubm(50,n,.1,2e3),this.camera.position.set(0,0,50);else{this.camera=new u.qUd(-500,500,500/n,-500/n,.1,2e3),this.camera.position.set(0,0,60)}}},{key:"addLight",value:function(){var e=new u.ZyN(16777215,1.5),t=new u.$p8(16777215,Math.PI);e.position.set(5,20,-5),t.position.set(0,20,0),this.add(t,e)}},{key:"setControlEnabled",value:function(e){this.controls.enabled=e}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"add",value:function(){var e;(e=this.scene).add.apply(e,arguments)}},{key:"cleanup",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t.filter(Boolean);a.forEach((function(e){e.removeFromParent(),requestIdleCallback((function(){e.traverse((function(e){return function(e){null==e||e.dispatchEvent({type:"removed"}),e.geometry&&(e.geometry.dispose(),delete e.geometry)}(e)}))}))})),a.length&&this.render()}},{key:"resize",value:function(){window.addEventListener("resize",this.handleWindowResize)}},{key:"updateFrustum",value:function(e){if(this.camera instanceof u.qUd){var t=this.camera.right;this.camera.left=-t,this.camera.right=t,this.camera.top=t/e,this.camera.bottom=-t/e,this.camera.updateProjectionMatrix()}else this.camera instanceof u.ubm&&(this.camera.aspect=e,this.camera.updateProjectionMatrix())}},{key:"renderSync",value:function(){this.destroyed||(this.render(),this.dispatchEvent({type:"afterRender"}))}},{key:"animate",value:function(e){this.renderSync(),this.animationId=requestAnimationFrame(this.animate.bind(this,e)),e&&!this.destroyed&&e()}},{key:"cancelAnimate",value:function(){-1!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=-1),this.renderSync()}}])}(function(){return(0,o.A)((function e(){(0,r.A)(this,e),this.listeners=new Map,this.tracedTypeSet=new Set}),[{key:"addEventListener",value:function(e,t){var n=this.listeners.get(e);n||(n=[],this.listeners.set(e,n)),n.includes(t)||n.push(t)}},{key:"removeEventListener",value:function(e,t){var n=this.listeners.get(e);if(n){var a=n.indexOf(t);-1!==a&&n.splice(a,1)}}},{key:"hasEventListener",value:function(e,t){var n=this.listeners.get(e);return!!n&&n.includes(t)}},{key:"getEventListeners",value:function(e){return this.listeners.get(e)}},{key:"dispatchEvent",value:function(e){var t=this.listeners.get(e.type);if(void 0!==t){e.target=this;for(var n=t.slice(0),a=0,i=n.length;a<i;a+=1)n[a].call(this,e);e.target=null}this.log(e)}},{key:"trace",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(t){return e.tracedTypeSet.add(t)}))}},{key:"log",value:function(e){if(this.tracedTypeSet.has(e.type)){var t=this.getEventListeners(e.type)||[];console.log("".concat(e.type," event executed ").concat(t.length," listeners")),console.log(t)}}}])}()),v=n(6070);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=(0,s.createContext)(null);function E(e){var t=(0,s.useState)(null),n=(0,i.A)(t,2),a=n[0],r=n[1],o=(0,s.useCallback)((function(e){r((function(){return e?new f(e):(null==a||a.dispose(),null)}))}),[]);(0,s.useEffect)((function(){return function(){a&&a.dispose()}}));var c="inner"===e.mode?e.style||{}:{position:"absolute",top:0,right:0,bottom:0,left:0,userSelect:"none"};return(0,v.jsxs)(g.Provider,{value:a,children:[(0,v.jsx)("div",{ref:o,style:c}),a&&e.children]})}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){return(0,v.jsx)(E,w(w({},t),{},{children:(0,v.jsx)(e,w({},n))}))}}},8537:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var a=n(758),i=n(8674),s=n(528),r=n(3063),o=n(8546),c=n(2367),l=n(9755),h=n(3205),d=n(870),u=n(9464),p=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function a(n){for(var a=0;a<t.children.length;a++)t.children[a].style.display=a===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),a(++e%t.children.length)}),!1);var i=(performance||Date).now(),s=i,r=0,o=n(new p.Panel("FPS","#0ff","#002")),c=n(new p.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=n(new p.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:t,addPanel:n,showPanel:a,begin:function(){i=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();if(c.update(e-i,200),e>=s+1e3&&(o.update(1e3*r/(e-s),100),s=e,r=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:a}};p.Panel=function(e,t,n){var a=1/0,i=0,s=Math.round,r=s(window.devicePixelRatio||1),o=80*r,c=48*r,l=3*r,h=2*r,d=3*r,u=15*r,p=74*r,y=30*r,f=document.createElement("canvas");f.width=o,f.height=c,f.style.cssText="width:80px;height:48px";var v=f.getContext("2d");return v.font="bold "+9*r+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=n,v.fillRect(0,0,o,c),v.fillStyle=t,v.fillText(e,l,h),v.fillRect(d,u,p,y),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(d,u,p,y),{dom:f,update:function(c,m){a=Math.min(a,c),i=Math.max(i,c),v.fillStyle=n,v.globalAlpha=1,v.fillRect(0,0,o,u),v.fillStyle=t,v.fillText(s(c)+" "+e+" ("+s(a)+"-"+s(i)+")",l,h),v.drawImage(f,d+r,u,p-r,y,d,u,p-r,y),v.fillRect(d+p-r,u,r,y),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(d+p-r,u,r,s((1-c/m)*y))}}};const y=p;function f(e,t,n){let{color:a=65280,scale:i=1,onInit:s,onUpdate:r}=void 0===n?{}:n;const o=[],c=new u.V9B({color:null!=a?a:65280,wireframe:!0}),l=new d.eB,h=new d.eB,p=new d.eB,y=new d.PT,f=new u.Gu$(1),v=new u.iNn(1,1,1),m=new u.bdM(10,10,10,10);function w(t,n){let a=o[t],s=!1;return function(e,t){if(!e)return!1;const{geometry:n}=e;return n instanceof u.Gu$&&t.type===d.yp.types.SPHERE||n instanceof u.iNn&&t.type===d.yp.types.BOX||n instanceof u.bdM&&t.type===d.yp.types.PLANE||n.id===t.geometryId&&t.type===d.yp.types.CYLINDER||n.id===t.geometryId&&t.type===d.yp.types.CONVEXPOLYHEDRON||n.id===t.geometryId&&t.type===d.yp.types.TRIMESH||n.id===t.geometryId&&t.type===d.yp.types.HEIGHTFIELD}(a,n)||(a&&e.remove(a),o[t]=a=function(t){let n=new u.eaF;const{SPHERE:a,BOX:i,PLANE:s,CYLINDER:r,CONVEXPOLYHEDRON:o,TRIMESH:y,HEIGHTFIELD:w}=d.yp.types;switch(t.type){case a:n=new u.eaF(f,c);break;case i:n=new u.eaF(v,c);break;case s:n=new u.eaF(m,c);break;case r:{const e=new u.Ho_(t.radiusTop,t.radiusBottom,t.height,t.numSegments);n=new u.eaF(e,c),t.geometryId=e.id;break}case o:{const e=function(e){const t=new u.LoY,n=[];for(let t=0;t<e.vertices.length;t++){const a=e.vertices[t];n.push(a.x,a.y,a.z)}t.setAttribute("position",new u.qtW(n,3));const a=[];for(let t=0;t<e.faces.length;t++){const n=e.faces[t],i=n[0];for(let e=1;e<n.length-1;e++){const t=n[e],s=n[e+1];a.push(i,t,s)}}return t.setIndex(a),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);n=new u.eaF(e,c),t.geometryId=e.id;break}case y:{const e=function(e){const t=new u.LoY,n=[],a=l,i=h,s=p;for(let t=0;t<e.indices.length/3;t++)e.getTriangleVertices(t,a,i,s),n.push(a.x,a.y,a.z),n.push(i.x,i.y,i.z),n.push(s.x,s.y,s.z);return t.setAttribute("position",new u.qtW(n,3)),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);n=new u.eaF(e,c),t.geometryId=e.id;break}case w:{const e=function(e){const t=new u.LoY,n=e.elementSize||1,a=e.data.flatMap(((e,t)=>e.flatMap(((e,a)=>[t*n,a*n,e])))),i=[];for(let t=0;t<e.data.length-1;t++)for(let n=0;n<e.data[t].length-1;n++){const a=e.data[t].length,s=t*a+n;i.push(s+1,s+a,s+a+1),i.push(s+a,s+1,s)}return t.setIndex(i),t.setAttribute("position",new u.qtW(a,3)),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);n=new u.eaF(e,c),t.geometryId=e.id;break}}return e.add(n),n}(n),s=!0),function(e,t){const{SPHERE:n,BOX:a,PLANE:s,CYLINDER:r,CONVEXPOLYHEDRON:o,TRIMESH:c,HEIGHTFIELD:l}=d.yp.types;switch(t.type){case n:{const{radius:n}=t;e.scale.set(n*i,n*i,n*i);break}case a:e.scale.copy(t.halfExtents),e.scale.multiplyScalar(2*i);break;case s:break;case r:case o:e.scale.set(1*i,1*i,1*i);break;case c:e.scale.copy(t.scale).multiplyScalar(i);break;case l:e.scale.set(1*i,1*i,1*i)}}(a,n),s}return m.translate(0,0,1e-4),{update:function(){const n=o,a=l,i=y;let c=0;for(const e of t.bodies)for(let t=0;t!==e.shapes.length;t++){const o=e.shapes[t],l=w(c,o),h=n[c];h&&(e.quaternion.vmult(e.shapeOffsets[t],a),e.position.vadd(a,a),e.quaternion.mult(e.shapeOrientations[t],i),h.position.copy(a),h.quaternion.copy(i),l&&s instanceof Function&&s(e,h,o),!l&&r instanceof Function&&r(e,h,o)),c++}for(let t=c;t<n.length;t++){const a=n[t];a&&e.remove(a)}n.length=c}}}var v=function(){return(0,l.A)((function e(){(0,c.A)(this,e);var t=new d.HK({gravity:new d.eB(0,-9.8,0)});t.broadphase=new d.EX(t),t.gravity.set(0,0,-10),t.defaultContactMaterial.friction=0;var n=new d.im("groundMaterial"),a=new d.im("wheelMaterial"),i=new d.QE(a,n,{friction:.3,restitution:0,contactEquationStiffness:1e3});t.addContactMaterial(i);var s=new d.az(new d.eB(2,1,.5)),r=new d.nB({mass:150});r.addShape(s),r.position.set(0,0,4),r.angularVelocity.set(0,0,.5);var o={radius:.5,directionLocal:new d.eB(0,0,-1),suspensionStiffness:30,suspensionRestLength:.3,frictionSlip:5,dampingRelaxation:2.3,dampingCompression:4.4,maxSuspensionForce:1e5,rollInfluence:.01,axleLocal:new d.eB(0,1,0),chassisConnectionPointLocal:new d.eB(1,1,0),maxSuspensionTravel:.3,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0},l=new d.a({chassisBody:r});o.chassisConnectionPointLocal.set(1,1,0),l.addWheel(o),o.chassisConnectionPointLocal.set(1,-1,0),l.addWheel(o),o.chassisConnectionPointLocal.set(-1,1,0),l.addWheel(o),o.chassisConnectionPointLocal.set(-1,-1,0),l.addWheel(o),l.addToWorld(t);for(var h=[],u=0;u<l.wheelInfos.length;u+=1){var p=l.wheelInfos[u],y=new d.T(p.radius,p.radius,p.radius/2,20),f=new d.nB({mass:0});f.type=d.nB.KINEMATIC,f.collisionFilterGroup=0;var v=new d.PT;v.setFromAxisAngle(new d.eB(1,0,0),Math.PI/2),f.addShape(y,new d.eB,v),h.push(f),t.addBody(f)}t.addEventListener("postStep",(function(){for(var e=0;e<l.wheelInfos.length;e+=1){l.updateWheelTransform(e);var t=l.wheelInfos[e].worldTransform,n=h[e];n.position.copy(t.position),n.quaternion.copy(t.quaternion)}}));for(var m=[],w=0;w<64;w+=1){m.push([]);for(var g=0;g<64;g+=1){var E=Math.cos(w/64*Math.PI*5)*Math.cos(g/64*Math.PI*5)*2+2;0!==w&&63!==w&&0!==g&&63!==g||(E=3),m[w].push(E)}}var k=new d.cW(m,{elementSize:1.5625}),b=new d.nB({mass:0});b.addShape(k),b.position.set(-64*k.elementSize/2,-64*k.elementSize/2,-1),t.addBody(b);var S=1e6,B=function(e){var t="keyup"===e.type;if(t||"keydown"===e.type)switch(l.setBrake(0,0),l.setBrake(0,1),l.setBrake(0,2),l.setBrake(0,3),e.key){case"w":l.applyEngineForce(t?0:-1e3,2),l.applyEngineForce(t?0:-1e3,3);break;case"s":l.applyEngineForce(t?0:1e3,2),l.applyEngineForce(t?0:1e3,3);break;case"b":l.setBrake(S,0),l.setBrake(S,1),l.setBrake(S,2),l.setBrake(S,3);break;case"a":l.setSteeringValue(t?0:-.5,0),l.setSteeringValue(t?0:-.5,1);break;case"d":l.setSteeringValue(t?0:.5,0),l.setSteeringValue(t?0:.5,1)}};document.addEventListener("keydown",B),document.addEventListener("keyup",B)}),null,[{key:"shape2mesh",value:function(e){var t=e.shapes[0],n=new u.LoY;if(t instanceof d.cW){for(var a=new d.eB,i=new d.eB,s=new d.eB,r=[],o=[],c=0;c<t.data.length-1;c+=1)for(var l=0;l<t.data[c].length-1;l+=1)for(var h=0;h<2;h+=1){t.getConvexTrianglePillar(c,l,0===h),a.copy(t.pillarConvex.vertices[0]),i.copy(t.pillarConvex.vertices[1]),s.copy(t.pillarConvex.vertices[2]),a.vadd(t.pillarOffset,a),i.vadd(t.pillarOffset,i),s.vadd(t.pillarOffset,s),r.push(a.x,a.y,a.z),r.push(i.x,i.y,i.z),r.push(s.x,s.y,s.z);var p=r.length/3-3;o.push(p,p+1,p+2)}var y=new Float32Array(r),f=new Uint32Array(o);n.setAttribute("position",new u.THS(y,3)),n.setIndex(new u.THS(f,1)),n.computeVertexNormals()}return new u.eaF(n)}}])}(),m=function(){return(0,l.A)((function e(t){var n=this;(0,c.A)(this,e),(0,h.A)(this,"wheels3D",[]),(0,h.A)(this,"carMoving",!1),(0,h.A)(this,"lastCallTime",0),(0,h.A)(this,"isObstacleMoving",!1),(0,h.A)(this,"isObstacleMovingTimeout",null),(0,h.A)(this,"handleKeydown",(function(e){if(n.carInfo&&n.raycastVehicle)switch(n.carMoving=!0,n.raycastVehicle.setBrake(0,0),n.raycastVehicle.setBrake(0,1),n.raycastVehicle.setBrake(0,2),n.raycastVehicle.setBrake(0,3),e.key){case"w":n.raycastVehicle.applyEngineForce(-500,0),n.raycastVehicle.applyEngineForce(-500,1),n.raycastVehicle.applyEngineForce(-500,2),n.raycastVehicle.applyEngineForce(-500,3);break;case"s":n.raycastVehicle.applyEngineForce(500,0),n.raycastVehicle.applyEngineForce(500,1),n.raycastVehicle.applyEngineForce(500,2),n.raycastVehicle.applyEngineForce(500,3);break;case"a":n.raycastVehicle.setSteeringValue(.5,2),n.raycastVehicle.setSteeringValue(.5,3);break;case"d":n.raycastVehicle.setSteeringValue(-.5,2),n.raycastVehicle.setSteeringValue(-.5,3);break;case"r":n.resetCar();break;case"b":n.brakeVehicle();break;case"q":var t=19.6;n.raycastVehicle.setBrake(t,0),n.raycastVehicle.setBrake(t,1),n.raycastVehicle.setBrake(t,2),n.raycastVehicle.setBrake(t,3),n.raycastVehicle.setSteeringValue(0,2),n.raycastVehicle.setSteeringValue(0,3)}})),(0,h.A)(this,"handleKeyup",(function(){setTimeout((function(){n.carMoving=!1}),2e3)})),(0,h.A)(this,"handleUpdateWheel",(function(){if(n.raycastVehicle&&n.carInfo&&n.carInfo.wheelBodies.length&&n.car3D){var e=n.raycastVehicle.chassisBody.position;n.car3D.position.set(e.x,e.y-.7,e.z),n.car3D.quaternion.copy(n.raycastVehicle.chassisBody.quaternion);for(var t=0;t<n.raycastVehicle.wheelInfos.length;t+=1){n.raycastVehicle.updateWheelTransform(t);var a=n.raycastVehicle.wheelInfos[t].worldTransform;n.wheels3D[t].position.copy(a.position),n.wheels3D[t].quaternion.copy(a.quaternion)}}})),(0,h.A)(this,"updateObstacle",(function(){if(n.obstacle){var e=n.obstacle,t=e.meshs,a=e.bodys;t.forEach((function(e,t){var n=a[t];e.position.copy(n.position),e.quaternion.copy(n.quaternion)}))}})),(0,h.A)(this,"tick",(function(){n.raycastVehicle&&n.raycastVehicle.chassisBody.velocity.length()<.1&&(n.raycastVehicle.chassisBody.velocity.set(0,0,0),n.raycastVehicle.chassisBody.angularVelocity.set(0,0,0));var e=1/60;n.cDebugger.update();var t=performance.now()/1e3;if(n.lastCallTime){var a=t-n.lastCallTime;n.physicsWorld.step(e,a)}else n.physicsWorld.step(e);n.lastCallTime=t,n.renderer.render(),n.animationId=window.requestAnimationFrame(n.tick)})),(0,h.A)(this,"handleContact",(function(){n.isObstacleMoving=!0,n.isObstacleMovingTimeout&&clearTimeout(n.isObstacleMovingTimeout),setTimeout((function(){n.isObstacleMoving=!1}),2e3)})),this.renderer=t,this.renderer.camera.position.set(0,5,25),this.renderer.camera.updateProjectionMatrix(),this.physicsWorld=new d.HK({gravity:new d.eB(0,-10,0)}),this.physicsWorld.broadphase=new d.EX(this.physicsWorld),this.renderer.add(new u.IzY(20)),this.cDebugger=f(this.renderer.scene,this.physicsWorld,{color:"#f44034"}),this.createWavyGround();var a=new d.im("groundMaterial"),i=new d.im("wheelMaterial"),s=new d.QE(i,a,{friction:.5,restitution:0,contactEquationStiffness:1e3});this.physicsWorld.addContactMaterial(s),this.addListenerEvents()}),[{key:"dispose",value:function(){var e;(e=this.renderer).cleanup.apply(e,[this.car3D,this.floor3D].concat((0,o.A)(this.wheels3D))),this.physicsWorld.clearForces(),this.animationId&&window.cancelAnimationFrame(this.animationId),this.removeListenerEvents()}},{key:"initStats",value:function(){this.stats=new y,this.stats.showPanel(0),document.body.appendChild(this.stats.dom)}},{key:"createFloor",value:function(){var e=new d.nB({mass:0,material:new d.im({friction:1})});e.addShape(new d.Zc),e.quaternion.setFromAxisAngle(new d.eB(-1,0,0),Math.PI/2),this.physicsWorld.addBody(e);var t=new u.eaF(new u.bdM(100,100),new u.V9B({color:14013909}));t.rotation.x=.5*-Math.PI,this.floor3D=t,this.renderer.add(this.floor3D)}},{key:"addCar",value:function(e,t){var n;this.car3D=e;var a=new d.nB({mass:150,shape:new d.az(new d.eB(1,.4,2.5)),material:new d.im({friction:.5})});this.raycastVehicle=new d.a({chassisBody:a,indexRightAxis:0,indexUpAxis:1,indexForwardAxis:2}),this.raycastVehicle.addToWorld(this.physicsWorld);var i={radius:.3,directionLocal:new d.eB(0,-1,0),suspensionStiffness:30,suspensionRestLength:.3,frictionSlip:5,dampingRelaxation:2.3,dampingCompression:4.3,maxSuspensionForce:1e5,rollInfluence:.01,axleLocal:new d.eB(-1,0,0),chassisConnectionPointLocal:new d.eB,maxSuspensionTravel:.3,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0},s=.9,r=1.55;i.chassisConnectionPointLocal.set(s,-.1,-r),this.raycastVehicle.addWheel(i),i.chassisConnectionPointLocal.set(-s,-.1,-r),this.raycastVehicle.addWheel(i),i.chassisConnectionPointLocal.set(s,-.1,r),this.raycastVehicle.addWheel(i),i.chassisConnectionPointLocal.set(-s,-.1,r),this.raycastVehicle.addWheel(i);for(var c=[],l=0;l<this.raycastVehicle.wheelInfos.length;l+=1){var h=new d.nB({mass:0}),u=this.raycastVehicle.wheelInfos[l].radius,p=new d.T(u,u,u/2,20),y=(new d.PT).setFromEuler(-Math.PI/2,0,0);h.addShape(p,new d.eB,y),h.type=d.nB.KINEMATIC,c.push(h);var f=t.clone();this.wheels3D.push(f)}this.carInfo={body:a,wheelBodies:c},(n=this.renderer).add.apply(n,[this.car3D].concat((0,o.A)(this.wheels3D))),this.renderer.render(),this.resetCar(),this.tick()}},{key:"createObstacle",value:function(){var e,t=this,n=.6,a=[],i=[],s=function(){for(var e=.3+3*n,t=[],a=0;a<4;a+=1){for(var i=[],s=0;s<=a;s+=1)i.push([s-a/2,e-a*n,10]);t.push(i)}return t.flat()}(),r=new u.iNn(n,n,n),o=new u.eaF(r,new u.V9B({color:16777215})),c=new d.az(new d.eB(.3,.3,.3));s.forEach((function(e){var n=o.clone();a.push(n);var s=new d.nB({mass:10});s.addShape(c),s.position.set(e[0],e[1],e[2]),i.push(s),t.physicsWorld.addBody(s)})),(e=this.renderer).add.apply(e,a),this.obstacle={meshs:a,bodys:i}}},{key:"brakeVehicle",value:function(){this.raycastVehicle&&(this.raycastVehicle.setBrake(150,0),this.raycastVehicle.setBrake(150,1),this.raycastVehicle.setBrake(150,2),this.raycastVehicle.setBrake(150,3))}},{key:"resetCar",value:function(){if(this.raycastVehicle){var e=this.raycastVehicle.chassisBody;e.position.set(0,.6,0),e.quaternion.set(0,0,0,1),e.angularVelocity.set(0,0,0),e.velocity.set(0,0,0)}}},{key:"addListenerEvents",value:function(){document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup),this.physicsWorld.addEventListener("postStep",this.handleUpdateWheel),this.physicsWorld.addEventListener("beginContact",this.handleContact)}},{key:"removeListenerEvents",value:function(){document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keydown",this.handleKeydown),this.physicsWorld.removeEventListener("postStep",this.handleUpdateWheel),this.physicsWorld.removeEventListener("beginContact",this.handleContact)}},{key:"createWavyGround",value:function(){for(var e=new d.nB({mass:0,material:new d.im({friction:1})}),t=[],n=0;n<64;n+=1){t.push([]);for(var a=0;a<64;a+=1){var i=Math.cos(n/64*Math.PI*5)*Math.cos(a/64*Math.PI*5)*2+2;0!==n&&63!==n&&0!==a&&63!==a||(i=3),t[n].push(i)}}var s=new d.cW(t,{elementSize:1});e.addShape(s),e.quaternion.setFromAxisAngle(new d.eB(-1,0,0),Math.PI/2),e.position.set(-20,-1,20),this.physicsWorld.addBody(e);var r=v.shape2mesh(e);r.material=new u.G_z({color:14540253}),r.rotation.x=-Math.PI/2,r.position.set(-20,-1,20),this.renderer.add(r)}}])}(),w=n(6070);const g=(0,r.U_)((function(){var e=(0,s.cq)(),t=(0,a.useContext)(r.P7),n=(0,i.A)((function(){return new m(t)}),[t]),o=(0,s.LG)();return(0,a.useEffect)((function(){var e=o["model-car"],t=o["model-wheel"];return n.addCar(e,t),function(){n.dispose()}}),[n]),"loading"===e.state?(0,w.jsx)("div",{children:"loading"}):(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{children:"自由驾驶"}),(0,w.jsx)("div",{children:"规划路线驾驶"})]})}))}}]);